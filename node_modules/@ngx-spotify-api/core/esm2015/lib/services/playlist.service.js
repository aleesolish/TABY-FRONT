/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Optional } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { of } from 'rxjs';
import { map } from 'rxjs/operators';
import { ApiConfig } from '../models';
import * as i0 from "@angular/core";
import * as i1 from "../models/configs/api.config";
import * as i2 from "@angular/common/http";
class Snapshot {
}
if (false) {
    /** @type {?} */
    Snapshot.prototype.snapshotId;
}
export class PlaylistService {
    /**
     * @param {?} config
     * @param {?} http
     */
    constructor(config, http) {
        this.config = config;
        this.http = http;
    }
    /**
     * @param {?} id
     * @param {?} uris
     * @param {?} position
     * @return {?}
     */
    addTracksToPlaylist(id, uris, position) {
        if (typeof uris !== typeof [] || uris.length < 1 || uris.length > 100) {
            return of(null);
        }
        return this.http.post(this.config.baseUrl + `/v1/playlists/${id}/tracks`, {
            uris: uris,
            position: position
        }).pipe(map(({ snapshotId }) => {
            return snapshotId;
        }));
    }
    /**
     * @param {?} id
     * @param {?} uris
     * @return {?}
     */
    removeTracksFromPlaylist(id, uris) {
        if (typeof uris !== typeof [] || uris.length < 1 || uris.length > 100) {
            return of(null);
        }
        return this.http.request('DELETE', this.config.baseUrl + `/v1/playlists/${id}/tracks`, {
            body: {
                tracks: uris.map((uri) => {
                    return { uri: uri };
                })
            }
        }).pipe(map(({ snapshotId }) => {
            return snapshotId;
        }));
    }
    /**
     * @param {?} id
     * @param {?=} market
     * @return {?}
     */
    getPlaylist(id, market) {
        return this.http.get(this.config.baseUrl + `/v1/playlists/${id}`, {
            params: {
                market: market || ''
            }
        });
    }
    /**
     * @param {?} id
     * @param {?} market
     * @param {?=} limit
     * @param {?=} offset
     * @return {?}
     */
    getPlaylistTracks(id, market, limit = 100, offset = 0) {
        return this.http.get(this.config.baseUrl + `/v1/playlists/${id}/tracks`, {
            params: {
                limit: limit.toString(),
                offset: offset.toString(),
                market: market
            }
        });
    }
    /**
     * @param {?} id
     * @return {?}
     */
    getPlaylistCover(id) {
        return this.http.get(this.config.baseUrl + `/v1/playlists/${id}/images`);
    }
    /**
     *
     * @param {?} id id of playlist
     * @param {?} image base64 encoded jpeg (max. 256KB)
     * @return {?}
     */
    uploadPlaylistCover(id, image) {
        return this.http.put(this.config.baseUrl + `/v1/playlists/${id}/images`, image, {
            headers: {
                'Content-Type': 'image/jpeg'
            }
        }).pipe(map((res) => {
            return true;
        }));
    }
    /**
     *
     * @param {?=} limit min=1, default=20, max=50
     * @param {?=} offset min=0, default=0, max=100000
     * @return {?}
     */
    getOwnPlaylists(limit = 20, offset = 0) {
        return this.http.get(this.config.baseUrl + `/v1/me/playlists`, {
            params: {
                limit: limit.toString(),
                offset: offset.toString()
            }
        });
    }
    /**
     * @param {?} id
     * @param {?=} name
     * @param {?=} isPublic
     * @param {?=} isCollaborative
     * @param {?=} description
     * @return {?}
     */
    updateDetails(id, name, isPublic, isCollaborative, description) {
        return this.http.put(this.config.baseUrl + `/v1/playlists/${id}`, {
            name,
            public: isPublic,
            collaborative: isCollaborative,
            description: description
        }, {
            headers: {
                'Content-Type': 'application/json'
            }
        }).pipe(map((res) => {
            return true;
        }));
    }
    /**
     * @param {?} id
     * @param {?=} limit
     * @param {?=} offset
     * @return {?}
     */
    getUsersPlaylists(id, limit = 20, offset = 0) {
        return this.http.get(this.config.baseUrl + `/v1/users/${id}/playlists`, {
            params: {
                limit: limit.toString(),
                offset: offset.toString()
            }
        });
    }
    /**
     * @param {?} id
     * @param {?} uris
     * @return {?}
     */
    replacePlaylistTracks(id, uris) {
        return this.http.put(this.config.baseUrl + `/v1/playlists/${id}/tracks`, {
            uris: uris
        }, {
            headers: {
                'Content-Type': 'application/json'
            }
        }).pipe(map((res) => {
            return true;
        }));
    }
    /**
     * @param {?} userid
     * @param {?} name
     * @param {?} isPublic
     * @param {?} isCollaborative
     * @param {?=} description
     * @return {?}
     */
    createPlaylists(userid, name, isPublic, isCollaborative, description = '') {
        return this.http.post(this.config.baseUrl + `/v1/users/${userid}/playlists`, {
            name,
            public: isPublic,
            collaborative: isCollaborative,
            description
        }, {
            headers: {
                'Content-Type': 'application/json'
            }
        });
    }
    /**
     * @param {?} id
     * @param {?} rangeStart
     * @param {?} rangeLength
     * @param {?} insertBefore
     * @param {?=} snapshot
     * @return {?}
     */
    reorderPlaylistTracks(id, rangeStart, rangeLength, insertBefore, snapshot) {
        return this.http.put(this.config.baseUrl + `/v1/playlists/${id}/tracks`, {
            range_start: rangeStart,
            insert_before: insertBefore,
            range_length: rangeLength,
            snapshot_id: snapshot
        }, {
            headers: {
                'Content-Type': 'application/json'
            }
        }).pipe(map((s) => s.snapshotId));
    }
}
PlaylistService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
PlaylistService.ctorParameters = () => [
    { type: ApiConfig, decorators: [{ type: Optional }] },
    { type: HttpClient }
];
/** @nocollapse */ PlaylistService.ngInjectableDef = i0.defineInjectable({ factory: function PlaylistService_Factory() { return new PlaylistService(i0.inject(i1.ApiConfig, 8), i0.inject(i2.HttpClient)); }, token: PlaylistService, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    PlaylistService.prototype.config;
    /**
     * @type {?}
     * @private
     */
    PlaylistService.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGxheWxpc3Quc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BuZ3gtc3BvdGlmeS1hcGkvY29yZS8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy9wbGF5bGlzdC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUMsVUFBVSxFQUFFLFFBQVEsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUNuRCxPQUFPLEVBQUMsVUFBVSxFQUFlLE1BQU0sc0JBQXNCLENBQUM7QUFDOUQsT0FBTyxFQUFhLEVBQUUsRUFBQyxNQUFNLE1BQU0sQ0FBQztBQUNwQyxPQUFPLEVBQUMsR0FBRyxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFLbkMsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLFdBQVcsQ0FBQzs7OztBQUVwQyxNQUFNLFFBQVE7Q0FFYjs7O0lBREMsOEJBQW1COztBQU1yQixNQUFNLE9BQU8sZUFBZTs7Ozs7SUFFMUIsWUFBZ0MsTUFBaUIsRUFDN0IsSUFBZ0I7UUFESixXQUFNLEdBQU4sTUFBTSxDQUFXO1FBQzdCLFNBQUksR0FBSixJQUFJLENBQVk7SUFBSSxDQUFDOzs7Ozs7O0lBRWxDLG1CQUFtQixDQUFDLEVBQVUsRUFBRSxJQUFjLEVBQUUsUUFBZ0I7UUFDckUsSUFBSSxPQUFPLElBQUksS0FBSyxPQUFPLEVBQUUsSUFBSSxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxJQUFJLENBQUMsTUFBTSxHQUFHLEdBQUcsRUFBRTtZQUNyRSxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNqQjtRQUNELE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQVcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEdBQUcsaUJBQWlCLEVBQUUsU0FBUyxFQUFFO1lBQ2xGLElBQUksRUFBRSxJQUFJO1lBQ1YsUUFBUSxFQUFFLFFBQVE7U0FDbkIsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxF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VUFBVTs7Ozs7Ozs7SUFrQkosaUNBQXFDOzs7OztJQUNyQywrQkFBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0luamVjdGFibGUsIE9wdGlvbmFsfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHtIdHRwQ2xpZW50LCBIdHRwUmVzcG9uc2V9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHtPYnNlcnZhYmxlLCBvZn0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7bWFwfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7UGxheWxpc3R9IGZyb20gJy4uL21vZGVscyc7XHJcbmltcG9ydCB7UGFnaW5nfSBmcm9tICcuLi9tb2RlbHMnO1xyXG5pbXBvcnQge1BsYXlsaXN0VHJhY2t9IGZyb20gJy4uL21vZGVscyc7XHJcbmltcG9ydCB7SW1hZ2V9IGZyb20gJy4uL21vZGVscyc7XHJcbmltcG9ydCB7QXBpQ29uZmlnfSBmcm9tICcuLi9tb2RlbHMnO1xyXG5cclxuY2xhc3MgU25hcHNob3Qge1xyXG4gIHNuYXBzaG90SWQ6IHN0cmluZztcclxufVxyXG5cclxuQEluamVjdGFibGUoe1xyXG4gIHByb3ZpZGVkSW46ICdyb290J1xyXG59KVxyXG5leHBvcnQgY2xhc3MgUGxheWxpc3RTZXJ2aWNlIHtcclxuXHJcbiAgY29uc3RydWN0b3IoQE9wdGlvbmFsKCkgcHJpdmF0ZSBjb25maWc6IEFwaUNvbmZpZyxcclxuICAgICAgICAgICAgICBwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQpIHsgfVxyXG5cclxuICBwdWJsaWMgYWRkVHJhY2tzVG9QbGF5bGlzdChpZDogc3RyaW5nLCB1cmlzOiBzdHJpbmdbXSwgcG9zaXRpb246IG51bWJlcik6IE9ic2VydmFibGU8c3RyaW5nPiB7XHJcbiAgICBpZiAodHlwZW9mIHVyaXMgIT09IHR5cGVvZiBbXSB8fCB1cmlzLmxlbmd0aCA8IDEgfHwgdXJpcy5sZW5ndGggPiAxMDApIHtcclxuICAgICAgcmV0dXJuIG9mKG51bGwpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0PFNuYXBzaG90Pih0aGlzLmNvbmZpZy5iYXNlVXJsICsgYC92MS9wbGF5bGlzdHMvJHtpZH0vdHJhY2tzYCwge1xyXG4gICAgICB1cmlzOiB1cmlzLFxyXG4gICAgICBwb3NpdGlvbjogcG9zaXRpb25cclxuICAgIH0pLnBpcGUobWFwKCh7IHNuYXBzaG90SWQgfSkgPT4ge1xyXG4gICAgICByZXR1cm4gc25hcHNob3RJZDtcclxuICAgIH0pKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyByZW1vdmVUcmFja3NGcm9tUGxheWxpc3QoaWQ6IHN0cmluZywgdXJpczogc3RyaW5nW10pOiBPYnNlcnZhYmxlPHN0cmluZz4ge1xyXG4gICAgaWYgKHR5cGVvZiB1cmlzICE9PSB0eXBlb2YgW10gfHwgdXJpcy5sZW5ndGggPCAxIHx8IHVyaXMubGVuZ3RoID4gMTAwKSB7XHJcbiAgICAgIHJldHVybiBvZihudWxsKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmh0dHAucmVxdWVzdDxTbmFwc2hvdD4oJ0RFTEVURScsIHRoaXMuY29uZmlnLmJhc2VVcmwgKyBgL3YxL3BsYXlsaXN0cy8ke2lkfS90cmFja3NgLCB7XHJcbiAgICAgIGJvZHk6IHtcclxuICAgICAgICB0cmFja3M6IHVyaXMubWFwKCh1cmk6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgcmV0dXJuIHsgdXJpOiB1cmkgfTtcclxuICAgICAgICB9KVxyXG4gICAgICB9XHJcbiAgICB9KS5waXBlKG1hcCgoeyBzbmFwc2hvdElkIH0pID0+IHtcclxuICAgICAgcmV0dXJuIHNuYXBzaG90SWQ7XHJcbiAgICB9KSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0UGxheWxpc3QoaWQ6IHN0cmluZywgbWFya2V0Pzogc3RyaW5nKTogT2JzZXJ2YWJsZTxQbGF5bGlzdD4ge1xyXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8UGxheWxpc3Q+KHRoaXMuY29uZmlnLmJhc2VVcmwgKyBgL3YxL3BsYXlsaXN0cy8ke2lkfWAsIHtcclxuICAgICAgcGFyYW1zOiB7XHJcbiAgICAgICAgbWFya2V0OiBtYXJrZXQgfHwgJydcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0UGxheWxpc3RUcmFja3MoaWQ6IHN0cmluZywgbWFya2V0OiBzdHJpbmcsIGxpbWl0OiBudW1iZXIgPSAxMDAsIG9mZnNldDogbnVtYmVyID0gMCk6IE9ic2VydmFibGU8UGFnaW5nPFBsYXlsaXN0VHJhY2s+PiB7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxQYWdpbmc8UGxheWxpc3RUcmFjaz4+KHRoaXMuY29uZmlnLmJhc2VVcmwgKyBgL3YxL3BsYXlsaXN0cy8ke2lkfS90cmFja3NgLCB7XHJcbiAgICAgIHBhcmFtczoge1xyXG4gICAgICAgIGxpbWl0OiBsaW1pdC50b1N0cmluZygpLFxyXG4gICAgICAgIG9mZnNldDogb2Zmc2V0LnRvU3RyaW5nKCksXHJcbiAgICAgICAgbWFya2V0OiBtYXJrZXRcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0UGxheWxpc3RDb3ZlcihpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxJbWFnZVtdPiB7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxJbWFnZVtdPih0aGlzLmNvbmZpZy5iYXNlVXJsICsgYC92MS9wbGF5bGlzdHMvJHtpZH0vaW1hZ2VzYCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKlxyXG4gICAqIEBwYXJhbSBpZCBpZCBvZiBwbGF5bGlzdFxyXG4gICAqIEBwYXJhbSBpbWFnZSBiYXNlNjQgZW5jb2RlZCBqcGVnIChtYXguIDI1NktCKVxyXG4gICAqL1xyXG4gIHB1YmxpYyB1cGxvYWRQbGF5bGlzdENvdmVyKGlkOiBzdHJpbmcsIGltYWdlOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcclxuICAgIHJldHVybiB0aGlzLmh0dHAucHV0KHRoaXMuY29uZmlnLmJhc2VVcmwgKyBgL3YxL3BsYXlsaXN0cy8ke2lkfS9pbWFnZXNgLCBpbWFnZSwge1xyXG4gICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdpbWFnZS9qcGVnJ1xyXG4gICAgICB9XHJcbiAgICB9KS5waXBlKG1hcCgocmVzOiBIdHRwUmVzcG9uc2U8YW55PikgPT4ge1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH0pKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqXHJcbiAgICogQHBhcmFtIGxpbWl0IG1pbj0xLCBkZWZhdWx0PTIwLCBtYXg9NTBcclxuICAgKiBAcGFyYW0gb2Zmc2V0IG1pbj0wLCBkZWZhdWx0PTAsIG1heD0xMDAwMDBcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0T3duUGxheWxpc3RzKGxpbWl0OiBudW1iZXIgPSAyMCwgb2Zmc2V0OiBudW1iZXIgPSAwKTogT2JzZXJ2YWJsZTxQYWdpbmc8UGxheWxpc3Q+PiB7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxQYWdpbmc8UGxheWxpc3Q+Pih0aGlzLmNvbmZpZy5iYXNlVXJsICsgYC92MS9tZS9wbGF5bGlzdHNgLCB7XHJcbiAgICAgIHBhcmFtczoge1xyXG4gICAgICAgIGxpbWl0OiBsaW1pdC50b1N0cmluZygpLFxyXG4gICAgICAgIG9mZnNldDogb2Zmc2V0LnRvU3RyaW5nKClcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgdXBkYXRlRGV0YWlscyhpZDogc3RyaW5nLCBuYW1lPzogc3RyaW5nLCBpc1B1YmxpYz86IGJvb2xlYW4sIGlzQ29sbGFib3JhdGl2ZT86IGJvb2xlYW4sIGRlc2NyaXB0aW9uPzogc3RyaW5nKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwLnB1dCh0aGlzLmNvbmZpZy5iYXNlVXJsICsgYC92MS9wbGF5bGlzdHMvJHtpZH1gLCB7XHJcbiAgICAgIG5hbWUsXHJcbiAgICAgIHB1YmxpYzogaXNQdWJsaWMsXHJcbiAgICAgIGNvbGxhYm9yYXRpdmU6IGlzQ29sbGFib3JhdGl2ZSxcclxuICAgICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uXHJcbiAgICB9LCB7XHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgIH1cclxuICAgIH0pLnBpcGUobWFwKChyZXM6IEh0dHBSZXNwb25zZTxhbnk+KTogYm9vbGVhbiA9PiB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSkpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFVzZXJzUGxheWxpc3RzKGlkOiBzdHJpbmcsIGxpbWl0OiBudW1iZXIgPSAyMCwgb2Zmc2V0OiBudW1iZXIgPSAwKTogT2JzZXJ2YWJsZTxQYWdpbmc8UGxheWxpc3Q+PiB7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxQYWdpbmc8UGxheWxpc3Q+Pih0aGlzLmNvbmZpZy5iYXNlVXJsICsgYC92MS91c2Vycy8ke2lkfS9wbGF5bGlzdHNgLCB7XHJcbiAgICAgIHBhcmFtczoge1xyXG4gICAgICAgIGxpbWl0OiBsaW1pdC50b1N0cmluZygpLFxyXG4gICAgICAgIG9mZnNldDogb2Zmc2V0LnRvU3RyaW5nKClcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVwbGFjZVBsYXlsaXN0VHJhY2tzKGlkOiBzdHJpbmcsIHVyaXM6IHN0cmluZ1tdKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwLnB1dCh0aGlzLmNvbmZpZy5iYXNlVXJsICsgYC92MS9wbGF5bGlzdHMvJHtpZH0vdHJhY2tzYCwge1xyXG4gICAgICB1cmlzOiB1cmlzXHJcbiAgICB9LCB7XHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgIH1cclxuICAgIH0pLnBpcGUobWFwKChyZXM6IEh0dHBSZXNwb25zZTxhbnk+KTogYm9vbGVhbiA9PiB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSkpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGNyZWF0ZVBsYXlsaXN0cyh1c2VyaWQ6IHN0cmluZywgbmFtZTogc3RyaW5nLCBpc1B1YmxpYzogYm9vbGVhbiwgaXNDb2xsYWJvcmF0aXZlOiBib29sZWFuLCBkZXNjcmlwdGlvbjogc3RyaW5nID0gJycpOiBPYnNlcnZhYmxlPFBsYXlsaXN0PiB7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwLnBvc3Q8UGxheWxpc3Q+KHRoaXMuY29uZmlnLmJhc2VVcmwgKyBgL3YxL3VzZXJzLyR7dXNlcmlkfS9wbGF5bGlzdHNgLCB7XHJcbiAgICAgIG5hbWUsXHJcbiAgICAgIHB1YmxpYzogaXNQdWJsaWMsXHJcbiAgICAgIGNvbGxhYm9yYXRpdmU6IGlzQ29sbGFib3JhdGl2ZSxcclxuICAgICAgZGVzY3JpcHRpb25cclxuICAgIH0sIHtcclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVvcmRlclBsYXlsaXN0VHJhY2tzKGlkOiBzdHJpbmcsIHJhbmdlU3RhcnQ6IG51bWJlciwgcmFuZ2VMZW5ndGg6IG51bWJlciwgaW5zZXJ0QmVmb3JlOiBudW1iZXIsIHNuYXBzaG90Pzogc3RyaW5nKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcclxuICAgIHJldHVybiB0aGlzLmh0dHAucHV0PFNuYXBzaG90Pih0aGlzLmNvbmZpZy5iYXNlVXJsICsgYC92MS9wbGF5bGlzdHMvJHtpZH0vdHJhY2tzYCwge1xyXG4gICAgICByYW5nZV9zdGFydDogcmFuZ2VTdGFydCxcclxuICAgICAgaW5zZXJ0X2JlZm9yZTogaW5zZXJ0QmVmb3JlLFxyXG4gICAgICByYW5nZV9sZW5ndGg6IHJhbmdlTGVuZ3RoLFxyXG4gICAgICBzbmFwc2hvdF9pZDogc25hcHNob3RcclxuICAgIH0sIHtcclxuICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgfVxyXG4gICAgfSkucGlwZShtYXAoKHM6IFNuYXBzaG90KSA9PiBzLnNuYXBzaG90SWQpKTtcclxuICB9XHJcbn1cclxuIl19